<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecretSwap.fun - Exchange your secrets anonymously</title>
    <script 
  src="https://www.paypal.com/sdk/js?client-id=BAASqHmRUaw9JpJWNA3d0XElWNNDdRQdytHNxWDxEtZTz8gICMWyhyqiKfNtkbc4Q8-f2aYdN5VR_ailf8&components=hosted-buttons&disable-funding=venmo&currency=USD">
</script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="logo">
            <div class="logo-icon">ğŸ¤«</div>
            <h1>SecretSwap<span class="fun">.fun</span></h1>
        </div>
        <p class="tagline">Share your secrets anonymously and get one in return</p>
    </header>
    
    <div class="container" id="secretFormContainer">
        <div class="step">
            <h2><span>1</span> Share your secret</h2>
            <textarea 
                id="secretInput" 
                class="secret-input" 
                placeholder="Write what's on your mind... (min 100, max 500 characters)"></textarea>
            <div class="char-count"><span id="charCount">0</span>/500 characters</div>
            <div class="error-message" id="lengthError">Secret must be at least 100 characters long</div>
        </div>
        
        <div class="step">
            <h2><span>2</span> Choose your emotion</h2>
            <div class="emotion-selector">
                <button class="emotion-btn" data-emotion="ğŸ˜Š">ğŸ˜Š</button>
                <button class="emotion-btn" data-emotion="ğŸ˜¢">ğŸ˜¢</button>
                <button class="emotion-btn" data-emotion="ğŸ˜ ">ğŸ˜ </button>
                <button class="emotion-btn" data-emotion="ğŸ˜³">ğŸ˜³</button>
            </div>
            <div class="error-message" id="emotionError">Please select an emotion</div>
        </div>
        
        <button id="submitBtn" class="submit-btn" disabled>Share anonymously</button>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Looking for a similar secret...</p>
        </div>
    </div>
    
    <div class="container" id="resultContainer" style="display: none;">
        <h2 id="resultTitle">Here is a secret similar to yours:</h2>
        <div class="secret-result" id="secretResult">
            Loading your secret...
        </div>
        
        <div class="actions-container" id="actionsContainer">
            <button class="action-btn keep-btn" data-action="keep">
                <span>ğŸ“</span> Keep
            </button>
            <button class="action-btn forget-btn" data-action="forget">
                <span>ğŸ§¹</span> Forget
            </button>
            <button class="action-btn support-btn" data-action="support">
                <span>ğŸ¤—</span> Support
            </button>
            <button class="action-btn reveal-btn" data-action="reveal">
                <span>ğŸ“£</span> Reveal
            </button>
        </div>
        
        <div class="paypal-container" id="paypalContainer">
            <div class="paypal-text">How much do you value this secret?</div>
            <div id="paypal-container-DKK8KM24TAJRE"></div>
        </div>
        
        <div class="stats-display" id="statsDisplay">
            <div class="stats-title">Community Response</div>
            <div class="stats-grid">
                <div class="stat-display">
                    <div class="stat-display-value" id="keepStat">0</div>
                    <div class="stat-display-label">Keep</div>
                </div>
                <div class="stat-display">
                    <div class="stat-display-value" id="forgetStat">0</div>
                    <div class="stat-display-label">Forget</div>
                </div>
                <div class="stat-display">
                    <div class="stat-display-value" id="supportStat">0</div>
                    <div class="stat-display-label">Support</div>
                </div>
                <div class="stat-display">
                    <div class="stat-display-value" id="revealStat">0</div>
                    <div class="stat-display-label">Reveal</div>
                </div>
            </div>
        </div>
        
        <div class="thank-you-message" id="thankYouMessage">
            Thank you for participating!
        </div>
        
        <button class="restart-btn" id="restartBtn">Share another secret</button>
    </div>
    
    <div class="how-it-works">
        <h2>How it works?</h2>
        <div class="steps">
            <div class="step-card">
                <div class="step-icon">ğŸ”’</div>
                <div class="step-number">1</div>
                <h3>Share anonymously</h3>
                <p>Write your secret and choose your current emotion.</p>
            </div>
            <div class="step-card">
                <div class="step-icon">ğŸ”„</div>
                <div class="step-number">2</div>
                <h3>Receive a secret</h3>
                <p>Instantly get a secret from someone feeling the same.</p>
            </div>
            <div class="step-card">
                <div class="step-icon">ğŸ’Œ</div>
                <div class="step-number">3</div>
                <h3>Support others</h3>
                <p>Keep, forget, or support a secret.</p>
            </div>
            <div class="step-card">
                <div class="step-icon">ğŸ¦Š</div>
                <div class="step-number">4</div>
                <h3>Release it</h3>
                <p>Share this secret with the whole world!</p>
            </div>
        </div>
    </div>
    
    <div class="container">
        <h2>Your secrets are safe</h2>
        <div class="features">
            <div class="feature">
                <div class="feature-icon">ğŸ”</div>
                <h3>Total anonymity</h3>
                <p>No personal information is collected or stored.</p>
            </div>
            <div class="feature">
                <div class="feature-icon">ğŸ”„</div>
                <h3>Instant exchanges</h3>
                <p>Receive a similar secret as soon as you share yours.</p>
            </div>
            <div class="feature">
                <div class="feature-icon">ğŸ’–</div>
                <h3>Caring community</h3>
                <p>A judgment-free space to free yourself.</p>
            </div>
        </div>
    </div>
    
    <div class="revealed-secrets-container">
        <h2 class="revealed-secrets-title">Revealed Secrets</h2>
        <div class="loading" id="revealedLoading">
            <div class="spinner"></div>
            <p>Loading revealed secrets...</p>
        </div>
        <div class="secrets-grid" id="revealedSecretsGrid">
            <!-- Revealed secrets will be loaded here -->
        </div>
    </div>
    
    <footer>
        <p>Â© 2025 SecretSwap.fun - All rights reserved</p>
        <p>An anonymous and caring space to share what's on your mind</p>
        <p><a href="#">Privacy Policy</a> | <a href="#">Terms of Use</a></p>
    </footer>

    <script>
        // Configuration - MISE Ã€ JOUR AVEC VOTRE URL
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxl22KQQGR-JZmUhOw17JZCHMMDz3hH_wM2ZzUMbYWFNqzjfeiiiCol9DEf-ifbu-E_1g/exec";
        
        // DOM Elements
        const secretInput = document.getElementById('secretInput');
        const charCount = document.getElementById('charCount');
        const lengthError = document.getElementById('lengthError');
        const emotionError = document.getElementById('emotionError');
        const emotionBtns = document.querySelectorAll('.emotion-btn');
        const submitBtn = document.getElementById('submitBtn');
        const loading = document.getElementById('loading');
        const resultContainer = document.getElementById('resultContainer');
        const resultTitle = document.getElementById('resultTitle');
        const secretResult = document.getElementById('secretResult');
        const actionsContainer = document.getElementById('actionsContainer');
        const thankYouMessage = document.getElementById('thankYouMessage');
        const actionBtns = document.querySelectorAll('.action-btn');
        const secretFormContainer = document.getElementById('secretFormContainer');
        const revealedLoading = document.getElementById('revealedLoading');
        const revealedSecretsGrid = document.getElementById('revealedSecretsGrid');
        const paypalContainer = document.getElementById('paypalContainer');
        const statsDisplay = document.getElementById('statsDisplay');
        const keepStat = document.getElementById('keepStat');
        const forgetStat = document.getElementById('forgetStat');
        const supportStat = document.getElementById('supportStat');
        const revealStat = document.getElementById('revealStat');
        const restartBtn = document.getElementById('restartBtn');
        
        let selectedEmotion = null;
        let currentRowId = null;
        let actionTaken = false;
        let secretStats = { keep: 0, forget: 0, support: 0, reveal: 0 };
        
        // Update character counter
        secretInput.addEventListener('input', () => {
            const text = secretInput.value;
            charCount.textContent = text.length;
            
            // Validate length
            if (text.length < 100) {
                lengthError.style.display = 'block';
            } else {
                lengthError.style.display = 'none';
            }
            
            // Enable/disable submit button
            updateSubmitButton();
        });
        
        // Emotion selection
        emotionBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // Remove previous selection
                emotionBtns.forEach(b => b.classList.remove('selected'));
                
                // Select new emotion
                btn.classList.add('selected');
                selectedEmotion = btn.dataset.emotion;
                emotionError.style.display = 'none';
                
                // Update submit button
                updateSubmitButton();
            });
        });
        
        // Update submit button state
        function updateSubmitButton() {
            const text = secretInput.value;
            if (text.length >= 100 && text.length <= 500 && selectedEmotion) {
                submitBtn.disabled = false;
            } else {
                submitBtn.disabled = true;
            }
        }
        
        // Submit secret
        submitBtn.addEventListener('click', async () => {
            const secret = secretInput.value;
            
            // Validate inputs
            if (secret.length < 100) {
                lengthError.style.display = 'block';
                return;
            }
            
            if (!selectedEmotion) {
                emotionError.style.display = 'block';
                return;
            }
            
            // Show loading indicator
            loading.style.display = 'block';
            submitBtn.disabled = true;
            
            try {
                // Send data to Google Sheets
                const response = await fetch(
                    `${SCRIPT_URL}?action=addSecret&secret=${encodeURIComponent(secret)}&emotion=${selectedEmotion}`
                );
                
                if (!response.ok) {
                    throw new Error('Failed to save secret');
                }
                
                const saveResult = await response.json();
                if (saveResult.status !== 'success') {
                    throw new Error(saveResult.message || 'Error saving secret');
                }
                
                // Now get a random secret with the same emotion
                const secretResponse = await fetch(
                    `${SCRIPT_URL}?action=getRandomSecret&emotion=${selectedEmotion}`
                );
                
                if (!secretResponse.ok) {
                    throw new Error('Failed to retrieve secret');
                }
                
                const secretData = await secretResponse.json();
                
                // Hide loading
                loading.style.display = 'none';
                
                // Hide the form container
                secretFormContainer.style.display = 'none';
                
                // Show the result container
                resultContainer.style.display = 'block';
                
                if (secretData.status === "no_secret") {
                    // No secret found for this emotion
                    resultTitle.textContent = "You're the first with this emotion!";
                    secretResult.textContent = "Share your secret to start the exchange. As soon as another person shares a similar secret, you'll receive it.";
                    actionsContainer.style.display = 'none';
                } else {
                    // Show the retrieved secret
                    secretResult.textContent = secretData.secret;
                    currentRowId = secretData.rowId;
                    resultTitle.textContent = "Here is a secret similar to yours:";
                    actionsContainer.style.display = 'flex';
                }
                
                // Reset form (but keep it hidden)
                secretInput.value = '';
                charCount.textContent = '0';
                emotionBtns.forEach(b => b.classList.remove('selected'));
                selectedEmotion = null;
                submitBtn.disabled = true;
                
                // Reset action buttons
                actionBtns.forEach(b => b.disabled = false);
                actionTaken = false;
                
                // Hide PayPal container initially
                paypalContainer.style.display = 'none';
                
                // Hide stats display
                statsDisplay.style.display = 'none';
                
                // Hide thank you message
                thankYouMessage.style.display = 'none';
                
                // Scroll to result
                resultContainer.scrollIntoView({ behavior: 'smooth' });
                
                // Load revealed secrets
                loadRevealedSecrets();
            } catch (error) {
                loading.style.display = 'none';
                submitBtn.disabled = false;
                alert("An error occurred: " + error.message);
            }
        });
        
        // Handle actions (Keep, Forget, Support, Reveal)
        actionBtns.forEach(btn => {
            btn.addEventListener('click', async () => {
                if (actionTaken) return;
                
                const action = btn.dataset.action;
                actionTaken = true;
                
                // Disable all action buttons
                actionBtns.forEach(b => b.disabled = true);
                
                try {
                    // Send request to increment counter
                    const response = await fetch(
                        `${SCRIPT_URL}?action=increment&rowId=${currentRowId}&counterType=${action}`
                    );
                    
                    if (!response.ok) {
                        throw new Error('Failed to update counter');
                    }
                    
                    const result = await response.json();
                    if (result.status !== 'success') {
                        throw new Error(result.message || 'Error updating counter');
                    }
                    
                    // Get updated stats for this secret
                    const statsResponse = await fetch(
                        `${SCRIPT_URL}?action=getSecretStats&rowId=${currentRowId}`
                    );
                    
                    if (!statsResponse.ok) {
                        throw new Error('Failed to get updated stats');
                    }
                    
                    const statsData = await statsResponse.json();
                    if (statsData.status === 'success') {
                        // Update local stats
                        secretStats.keep = statsData.keep;
                        secretStats.forget = statsData.forget;
                        secretStats.support = statsData.support;
                        secretStats.reveal = statsData.reveal;
                        
                        // Show stats display
                        updateStatsDisplay();
                        statsDisplay.style.display = 'block';
                    }
                    
                    // Show PayPal container only for Reveal action
                    if (action === 'reveal') {
                        paypalContainer.style.display = 'block';
                        
                        // Initialize PayPal button
                        paypal.HostedButtons({
                            hostedButtonId: "DKK8KM24TAJRE",
                        }).render("#paypal-container-DKK8KM24TAJRE");
                    }
                    
                    // Show thank you message
                    thankYouMessage.style.display = 'block';
                    
                    // If action is reveal, reload revealed secrets
                    if (action === 'reveal') {
                        loadRevealedSecrets();
                    }
                } catch (error) {
                    alert("Error: " + error.message);
                    actionBtns.forEach(b => b.disabled = false);
                    actionTaken = false;
                }
            });
        });
        
        // Update stats display
        function updateStatsDisplay() {
            keepStat.textContent = secretStats.keep;
            forgetStat.textContent = secretStats.forget;
            supportStat.textContent = secretStats.support;
            revealStat.textContent = secretStats.reveal;
        }
        
        // Restart button - show form again
        restartBtn.addEventListener('click', () => {
            resultContainer.style.display = 'none';
            secretFormContainer.style.display = 'block';
            secretFormContainer.scrollIntoView({ behavior: 'smooth' });
        });
        
        // Load revealed secrets
        async function loadRevealedSecrets() {
            revealedLoading.style.display = 'block';
            revealedSecretsGrid.innerHTML = '';
            
            try {
                const response = await fetch(`${SCRIPT_URL}?action=getRevealedSecrets`);
                
                if (!response.ok) {
                    throw new Error('Failed to load revealed secrets');
                }
                
                const data = await response.json();
                
                if (data.status === "success" && data.secrets && data.secrets.length > 0) {
                    data.secrets.forEach(secret => {
                        const secretCard = createSecretCard(secret);
                        revealedSecretsGrid.appendChild(secretCard);
                    });
                } else {
                    revealedSecretsGrid.innerHTML = `
                        <div class="no-secrets" style="text-align: center; grid-column: 1 / -1; padding: 40px;">
                            <h3>No secrets revealed yet</h3>
                            <p>Be the first to reveal a secret that resonates with others!</p>
                        </div>
                    `;
                }
            } catch (error) {
                revealedSecretsGrid.innerHTML = `
                    <div class="error" style="text-align: center; grid-column: 1 / -1; padding: 40px; color: var(--coral);">
                        <h3>Error loading secrets</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            } finally {
                revealedLoading.style.display = 'none';
            }
        }
        
        // Create secret card for revealed secrets
        function createSecretCard(secret) {
            const card = document.createElement('div');
            card.className = 'secret-card';
            
            card.innerHTML = `
                <div class="secret-emotion">${secret.emotion}</div>
                <div class="secret-content">${secret.secret}</div>
                <div class="stats-container">
                    <div class="stat-item keep-stat">
                        <div class="stat-value">${secret.keep}</div>
                        <div class="stat-label">Keep</div>
                    </div>
                    <div class="stat-item forget-stat">
                        <div class="stat-value">${secret.forget}</div>
                        <div class="stat-label">Forget</div>
                    </div>
                    <div class="stat-item support-stat">
                        <div class="stat-value">${secret.support}</div>
                        <div class="stat-label">Support</div>
                    </div>
                    <div class="stat-item reveal-stat">
                        <div class="stat-value">${secret.reveal}</div>
                        <div class="stat-label">Reveal</div>
                    </div>
                </div>
            `;
            
            return card;
        }
        
        // Initial load
        document.addEventListener('DOMContentLoaded', () => {
            loadRevealedSecrets();
            
            // Update character count on page load
            charCount.textContent = secretInput.value.length;
            updateSubmitButton();
            
            // Hide the result container initially
            resultContainer.style.display = 'none';
            
            // Hide PayPal container initially
            paypalContainer.style.display = 'none';
        });
    </script>
</body>
</html>