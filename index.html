<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecretSwap.fun - Exchange Secrets Anonymously</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://www.paypal.com/sdk/js?client-id=BAASqHmRUaw9JpJWNA3d0XElWNNDdRQdytHNxWDxEtZTz8gICMWyhyqiKfNtkbc4Q8-f2aYdN5VR_ailf8&components=hosted-buttons&disable-funding=venmo&currency=EUR"></script>
</head>
<body>
    <div class="secret-counter">
        <i class="fas fa-lock"></i>
        <span id="totalSecrets">0</span> secrets shared
    </div>
    
    <header>
        <div class="logo">
            <div class="logo-icon">🤫</div>
            <h1>SecretSwap<span class="fun">.fun</span></h1>
        </div>
        <p class="tagline">Anonymously exchange your secrets and receive one in return</p>
    </header>
    
    <div class="container">
        <div class="step">
            <h2><span>1</span> Share Your Secret</h2>
            <textarea 
                id="secretInput" 
                class="secret-input" 
                placeholder="Write what's weighing on you here... (max 200 characters)"></textarea>
            <div class="char-count"><span id="charCount">0</span>/200 characters</div>
        </div>
        
        <div class="step">
            <h2><span>2</span> Choose Your Emotion</h2>
            <div class="emotion-selector">
                <button class="emotion-btn" data-emotion="😊">😊</button>
                <button class="emotion-btn" data-emotion="😢">😢</button>
                <button class="emotion-btn" data-emotion="😠">😠</button>
                <button class="emotion-btn" data-emotion="😳">😳</button>
            </div>
        </div>
        
        <button id="submitBtn" class="submit-btn" disabled>Share Anonymously</button>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Finding a similar secret...</p>
        </div>
        
        <div class="error-message" id="errorMessage"></div>
        
        <div class="result-container" id="resultContainer">
            <h2>Here's a secret similar to yours:</h2>
            <div class="secret-result" id="secretResult">
                Loading your secret...
            </div>
            <div class="secret-emotion" id="secretEmotion"></div>
            
            <div class="response-section">
                <p>What would you like to do with this secret?</p>
                <div class="action-buttons">
                    <button class="action-btn keep-btn" id="keepBtn">
                        <span>Keep</span> <span>🤫</span>
                    </button>
                    <button class="action-btn forget-btn" id="forgetBtn">
                        <span>Forget</span> <span>🙈</span>
                    </button>
                    <button class="action-btn reveal-btn" id="revealBtn">
                        <span>Reveal</span> <span>💰</span>
                    </button>
                </div>
            </div>
            
            <div class="paypal-container" id="paypalContainer">
                <p>By revealing this secret, you support our platform. Thank you!</p>
                <div id="paypal-container-MJ85LP7VFBJQE"></div>
            </div>
        </div>
    </div>
    
    <div class="how-it-works">
        <h2>How It Works</h2>
        <div class="steps">
            <div class="step-card">
                <div class="step-icon">🔒</div>
                <div class="step-number">1</div>
                <h3>Share Anonymously</h3>
                <p>Write your secret and choose your current emotion.</p>
            </div>
            <div class="step-card">
                <div class="step-icon">🔄</div>
                <div class="step-number">2</div>
                <h3>Receive a Secret</h3>
                <p>Instantly get a secret from someone feeling the same way.</p>
            </div>
            <div class="step-card">
                <div class="step-icon">💬</div>
                <div class="step-number">3</div>
                <h3>Choose Your Reaction</h3>
                <p>Keep the secret, forget it, or reveal it to support the platform.</p>
            </div>
            <div class="step-card">
                <div class="step-icon">💎</div>
                <div class="step-number">4</div>
                <h3>Reveal Secrets</h3>
                <p>Support the platform by revealing secrets with a donation.</p>
            </div>
        </div>
    </div>
    
    <div class="container">
        <h2>Your Secrets Are Safe</h2>
        <div class="features">
            <div class="feature">
                <div class="feature-icon">🔐</div>
                <h3>Total Anonymity</h3>
                <p>No personal information is collected or stored.</p>
            </div>
            <div class="feature">
                <div class="feature-icon">⚡</div>
                <h3>Instant Exchange</h3>
                <p>Receive a similar secret as soon as you share yours.</p>
            </div>
            <div class="feature">
                <div class="feature-icon">💖</div>
                <h3>Caring Community</h3>
                <p>A judgment-free space to unburden yourself.</p>
            </div>
        </div>
    </div>
    
    <div class="container revealed-secrets-container">
        <h2>Revealed Secrets</h2>
        <p>These secrets have been generously revealed by our community:</p>
        
        <div id="revealedSecretsList" class="no-secrets">
            <i class="fas fa-lock-open"></i>
            <p>No secrets revealed yet. Be the first to reveal one!</p>
        </div>
    </div>
    
    <footer>
        <p>© 2025 SecretSwap.fun - All rights reserved</p>
        <p>An anonymous and caring space to share what weighs on you</p>
        <p><a href="#" style="color: var(--teal); text-decoration: none;">Privacy Policy</a> | <a href="#" style="color: var(--teal); text-decoration: none;">Terms of Use</a></p>
    </footer>

 <script>
// Configuration
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbysek7Ktw3bVSnOHVYzLBaRDXpqwhDuRYttsC3SCoLN0XTPkCdVfktooi6gRlk5lvQt/exec";

// Fonction pour gérer les requêtes avec réessai
async function fetchWithRetry(url, options = {}, retries = 3) {
    try {
        const response = await fetch(url, options);
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        return response.json();
    } catch (error) {
        if (retries > 0) {
            console.log(`Retrying... (${retries} attempts left)`);
            await new Promise(resolve => setTimeout(resolve, 2000));
            return fetchWithRetry(url, options, retries - 1);
        }
        throw error;
    }
}

// Secret submission
submitBtn.addEventListener('click', async () => {
    const secret = secretInput.value;
    
    if (!secret || !selectedEmotion) {
        showError("Please enter a secret and select an emotion");
        return;
    }

    loading.style.display = 'block';
    submitBtn.disabled = true;
    errorMessage.style.display = 'none';
    
    try {
        // Envoyer le secret
        await fetchWithRetry(
            `${SCRIPT_URL}?action=submitSecret&secret=${encodeURIComponent(secret)}&emotion=${selectedEmotion}`,
            { method: 'GET' }
        );

        // Récupérer un secret aléatoire
        const secretData = await fetchWithRetry(
            `${SCRIPT_URL}?action=getRandomSecret&emotion=${selectedEmotion}`,
            { method: 'GET' }
        );

        // ... reste du code inchangé ...
    } catch (error) {
        loading.style.display = 'none';
        submitBtn.disabled = false;
        showError("An error occurred: " + error.message);
        console.error("Fetch error:", error);
    }
});

// Fonction pour charger les secrets révélés
async function loadRevealedSecrets() {
    try {
        const secrets = await fetchWithRetry(
            `${SCRIPT_URL}?action=getRevealedSecrets`,
            { method: 'GET' }
        );
        // ... reste du code inchangé ...
    } catch (error) {
        console.error("Failed to load revealed secrets:", error);
    }
}
</script>
</body>
</html>